import{d as V,r as m,_ as I,c as v,o as g,a as S,u as s,s as h,b as B,e as t,w as _,v as w,f as E,F as T,g as C,h as f,t as c,i as N}from"./index-CxXBdjJt.js";import{a as O,C as U,p as q,b as M,c as $,B as L,d as A,L as R,e as Y}from"./index-B-4bjD19.js";const z=V("incomes",()=>{const y=m([]),n=m(!1),b=m(null),i=m(1),r=m(500),u=m(1),p=l=>l.toISOString().split("T")[0],d=m({dateFrom:p(new Date(new Date().setDate(new Date().getDate()-7))),dateTo:p(new Date),limit:r.value,region:""}),D=m([25,50,100,250,500]);async function o(){try{n.value=!0,b.value=null;const l="E6kUTYrYwZq2tN4QEtyzsbEBk3ie",F=new Date,wt=p(F),Pt=p(new Date(F.setDate(F.getDate()-7))),x=await O.get("http://109.73.206.144:6969/api/incomes",{params:{key:l,page:i.value,limit:d.value.limit,dateFrom:d.value.dateFrom,dateTo:d.value.dateTo}});console.log("incomes: ",x.data.data),y.value=x.data.data,u.value=Math.ceil(x.data.meta.total/r.value)}catch(l){b.value=`Ошибка ${l.response?.status||400}: ${l.response?.data?.message||"Неверный запрос"}`,console.error("Детали ошибки:",l.config)}finally{n.value=!1}}function k(){i.value<u.value&&(i.value++,o())}function P(){i.value>1&&(i.value--,o())}function e(l={}){i.value=1,d.value={...d.value,...l},r.value=d.value.limit,o()}function a(){const l=new Date;e({dateFrom:p(new Date(l.setDate(l.getDate()-7))),dateTo:p(new Date),lmit:500,region:""})}return{incomes:y,loading:n,error:b,page:i,totalPages:u,filters:d,limitOptions:D,fetchIncomes:o,nextPage:k,prevPage:P,applyFilters:e,resetFilters:a}}),K={class:"chart-container"},Q={__name:"IncomesChart",props:{incomes:{type:Array,required:!0}},setup(y){U.register(q,M,$,L,A,R);const n=y,b={labels:n.incomes.map(r=>r.barcode),datasets:[{label:"Колличество проданного товара",backgroundColor:"#f87979",data:n.incomes.map(r=>parseInt(r.quantity))}]},i=m({responsive:!0,maintainAspectRatio:!1,scales:{x:{title:{display:!0,text:"штрихкод товара"}},y:{title:{display:!0,text:"колличество продано"}}}});return(r,u)=>(g(),v("div",K,[S(s(Y),{data:b,options:i.value},null,8,["options"])]))}},Z=I(Q,[["__scopeId","data-v-f10f6006"]]),j={class:"card filters-card"},G={class:"card-body"},H={class:"filters-grid"},J={class:"filter-group"},W={class:"filter-group"},X={class:"filter-group"},tt={class:"filter-group"},et=["value"],st={class:"filter-actions"},at={key:0,class:"loading-state"},nt={key:1,class:"error-state"},ot={key:2},lt={key:0,class:"card chart-card"},it={class:"card-body"},rt={class:"pagination-top"},dt={class:"pagination-info"},ut={class:"orders-count"},pt={class:"pagination-controls"},ct=["disabled"],vt=["disabled"],gt={class:"table-card card"},mt={class:"table-responsive"},bt={class:"spa-table"},ft={class:"order-number"},yt={class:"pagination-bottom"},_t={class:"pagination-info"},Dt={class:"pagination-controls"},kt=["disabled"],Ft=["disabled"],xt={__name:"IncomesPage",setup(y){const n=z(),{incomes:b,loading:i,error:r,page:u,totalPages:p,filters:d,limitOptions:D}=h(n),o=m({dateFrom:d.value.dateFrom,dateTo:d.value.dateTo,region:d.value.region,limit:d.value.limit}),k=()=>{n.applyFilters(o.value)};return B(()=>{n.fetchIncomes()}),(P,e)=>(g(),v("div",null,[e[25]||(e[25]=t("h2",null,"Доходы",-1)),t("div",j,[e[15]||(e[15]=t("div",{class:"card-header"},[t("h2",null,"Фильтры")],-1)),t("div",G,[t("div",H,[t("div",J,[e[9]||(e[9]=t("label",null,"Дата от",-1)),_(t("input",{type:"date","onUpdate:modelValue":e[0]||(e[0]=a=>o.value.dateFrom=a),class:"filter-input"},null,512),[[w,o.value.dateFrom]])]),t("div",W,[e[10]||(e[10]=t("label",null,"Дата до",-1)),_(t("input",{type:"date","onUpdate:modelValue":e[1]||(e[1]=a=>o.value.dateTo=a),class:"filter-input"},null,512),[[w,o.value.dateTo]])]),t("div",X,[e[11]||(e[11]=t("label",null,"Регион",-1)),_(t("input",{type:"text","onUpdate:modelValue":e[2]||(e[2]=a=>o.value.region=a),placeholder:"Введите область",class:"filter-input"},null,512),[[w,o.value.region]])]),t("div",tt,[e[12]||(e[12]=t("label",null,"Записей на одну страницу",-1)),_(t("select",{"onUpdate:modelValue":e[3]||(e[3]=a=>o.value.limit=a),class:"filter-сount-per-page"},[(g(!0),v(T,null,C(s(D),a=>(g(),v("option",{key:a,value:a},c(a),9,et))),128))],512),[[E,o.value.limit]])]),t("div",st,[t("button",{onClick:k,class:"btn btn-primary apply-btn"},e[13]||(e[13]=[t("span",{class:"btn-icon"},"✓",-1),f(" Применить ",-1)])),t("button",{onClick:e[4]||(e[4]=(...a)=>s(n).resetFilters&&s(n).resetFilters(...a)),class:"btn btn-secondary reset-btn"},e[14]||(e[14]=[t("span",{class:"btn-icon"},"↺",-1),f(" Сбросить ",-1)]))])])])]),s(i)?(g(),v("div",at,e[16]||(e[16]=[t("div",{class:"spinner"},null,-1),t("p",null,"Загрузка данных...",-1)]))):s(r)?(g(),v("div",nt,[e[17]||(e[17]=t("div",{class:"error-icon"},"⚠️",-1)),e[18]||(e[18]=t("h3",null,"Произошла ошибка",-1)),t("p",null,c(s(r)),1)])):(g(),v("div",ot,[!s(i)&&!s(r)?(g(),v("div",lt,[e[19]||(e[19]=t("div",{class:"card-header"},[t("h2",null,"Визуализация доходов")],-1)),t("div",it,[S(Z,{incomes:s(b)},null,8,["incomes"])])])):N("",!0),t("div",rt,[t("div",dt,[t("span",null,"Страница "+c(s(u))+" из "+c(s(p)),1),t("span",ut,"Всего записей: "+c(s(n).totalOrders),1)]),t("div",pt,[t("button",{onClick:e[5]||(e[5]=(...a)=>s(n).prevPage&&s(n).prevPage(...a)),disabled:s(u)===1,class:"btn-pagination"},e[20]||(e[20]=[t("span",{class:"pagination-icon"},"←",-1),f(" Назад ",-1)]),8,ct),t("button",{onClick:e[6]||(e[6]=(...a)=>s(n).nextPage&&s(n).nextPage(...a)),disabled:s(u)===s(p),class:"btn-pagination"},e[21]||(e[21]=[f(" Вперед ",-1),t("span",{class:"pagination-icon"},"→",-1)]),8,vt)])]),t("div",gt,[t("div",mt,[t("table",bt,[e[22]||(e[22]=t("thead",null,[t("tr",null,[t("th",null,"№"),t("th",null,"Колличество продано"),t("th",null,"Название склада"),t("th",null,"Штрикод товара")])],-1)),t("tbody",null,[(g(!0),v(T,null,C(s(b),(a,l)=>(g(),v("tr",{key:a.id},[t("td",ft,c(l+1),1),t("td",null,c(a.quantity),1),t("td",null,c(a.warehouse_name),1),t("td",null,c(a.barcode),1)]))),128))])])])]),t("div",yt,[t("div",_t,[t("span",null,"Страница "+c(s(u))+" из "+c(s(p)),1)]),t("div",Dt,[t("button",{onClick:e[7]||(e[7]=(...a)=>s(n).prevPage&&s(n).prevPage(...a)),disabled:s(u)===1,class:"btn-pagination"},e[23]||(e[23]=[t("span",{class:"pagination-icon"},"←",-1),f(" Назад ",-1)]),8,kt),t("button",{onClick:e[8]||(e[8]=(...a)=>s(n).nextPage&&s(n).nextPage(...a)),disabled:s(u)===s(p),class:"btn-pagination"},e[24]||(e[24]=[f(" Вперед ",-1),t("span",{class:"pagination-icon"},"→",-1)]),8,Ft)])])]))]))}},It=I(xt,[["__scopeId","data-v-5a0027da"]]);export{It as default};
