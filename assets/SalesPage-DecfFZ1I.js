import{d as w,r as g,_ as P,c,o as v,a as T,u as a,s as V,b as B,e as t,w as y,v as h,f as E,F as D,g as C,h as _,t as i,i as N,n as O}from"./index-CxXBdjJt.js";import{a as U,C as M,p as $,b as I,c as L,B as q,d as z,L as A,e as K}from"./index-B-4bjD19.js";const R=w("sales",()=>{const f=g([]),l=g(!1),b=g(null),r=g(1),d=g(500),p=g(1),m=o=>o.toISOString().split("T")[0],u=g({dateFrom:m(new Date(new Date().setDate(new Date().getDate()-7))),dateTo:m(new Date),limit:d.value,region:""}),x=g([25,50,100,250,500]);async function n(){try{l.value=!0,b.value=null;const k=await U.get("http://109.73.206.144:6969/api/sales",{params:{key:"E6kUTYrYwZq2tN4QEtyzsbEBk3ie",page:r.value,limit:u.value.limit,dateFrom:u.value.dateFrom,dateTo:u.value.dateTo}});console.log("sales: ",k.data.data),f.value=k.data.data,p.value=Math.ceil(k.data.meta.total/d.value)}catch(o){b.value=`Ошибка ${o.response?.status||400}: ${o.response?.data?.message||"Неверный запрос"}`,console.error("Детали ошибки:",o.config)}finally{l.value=!1}}function F(){r.value<p.value&&(r.value++,n())}function S(){r.value>1&&(r.value--,n())}function s(o={}){r.value=1,u.value={...u.value,...o},d.value=u.value.limit,n()}function e(){const o=new Date;s({dateFrom:m(new Date(o.setDate(o.getDate()-7))),dateTo:m(new Date),lmit:500,region:""})}return{sales:f,loading:l,error:b,page:r,totalPages:p,filters:u,limitOptions:x,fetchSales:n,nextPage:F,prevPage:S,applyFilters:s,resetFilters:e}}),Y={class:"chart-container"},Q={__name:"SalesChart",props:{sales:{type:Array,required:!0}},setup(f){M.register($,I,L,q,z,A);const l=f,b={labels:l.sales.map(d=>d.barcode),datasets:[{label:"Сумма продаж товара",backgroundColor:"#f87979",data:l.sales.map(d=>d.total_price)}]},r=g({responsive:!0,maintainAspectRatio:!1,scales:{x:{title:{display:!0,text:"Штрихкод"}},y:{title:{display:!0,text:"Сумма (руб)"}}}});return(d,p)=>(v(),c("div",Y,[T(a(K),{data:b,options:r.value},null,8,["options"])]))}},Z=P(Q,[["__scopeId","data-v-648c706f"]]),j={class:"orders-page"},G={class:"card filters-card"},H={class:"card-body"},J={class:"filters-grid"},W={class:"filter-group"},X={class:"filter-group"},tt={class:"filter-group"},st={class:"filter-group"},et=["value"],at={class:"filter-actions"},lt={key:0,class:"loading-state"},nt={key:1,class:"error-state"},ot={key:2},it={key:0,class:"card chart-card"},rt={class:"card-body"},dt={class:"pagination-top"},ut={class:"pagination-info"},pt={class:"orders-count"},ct={class:"pagination-controls"},vt=["disabled"],gt=["disabled"],mt={class:"table-card card"},bt={class:"table-responsive"},_t={class:"spa-table"},ft={class:"order-number"},yt={class:"region-tag"},xt={class:"text-right"},Ft={class:"price"},kt={class:"pagination-bottom"},ht={class:"pagination-info"},St={class:"pagination-controls"},Dt=["disabled"],Ct=["disabled"],Pt={__name:"SalesPage",setup(f){const l=R(),{sales:b,loading:r,error:d,page:p,totalPages:m,filters:u,limitOptions:x}=V(l),n=g({dateFrom:u.value.dateFrom,dateTo:u.value.dateTo,region:u.value.region,limit:u.value.limit}),F=()=>{l.applyFilters(n.value)};return B(()=>{l.fetchSales()}),(S,s)=>(v(),c("div",j,[s[25]||(s[25]=t("h2",null,"Продажи",-1)),t("div",G,[s[15]||(s[15]=t("div",{class:"card-header"},[t("h2",null,"Фильтры")],-1)),t("div",H,[t("div",J,[t("div",W,[s[9]||(s[9]=t("label",null,"Дата от",-1)),y(t("input",{type:"date","onUpdate:modelValue":s[0]||(s[0]=e=>n.value.dateFrom=e),class:"filter-input"},null,512),[[h,n.value.dateFrom]])]),t("div",X,[s[10]||(s[10]=t("label",null,"Дата до",-1)),y(t("input",{type:"date","onUpdate:modelValue":s[1]||(s[1]=e=>n.value.dateTo=e),class:"filter-input"},null,512),[[h,n.value.dateTo]])]),t("div",tt,[s[11]||(s[11]=t("label",null,"Регион",-1)),y(t("input",{type:"text","onUpdate:modelValue":s[2]||(s[2]=e=>n.value.region=e),placeholder:"Введите область",class:"filter-input"},null,512),[[h,n.value.region]])]),t("div",st,[s[12]||(s[12]=t("label",null,"Записей на одну страницу",-1)),y(t("select",{"onUpdate:modelValue":s[3]||(s[3]=e=>n.value.limit=e),class:"filter-сount-per-page"},[(v(!0),c(D,null,C(a(x),e=>(v(),c("option",{key:e,value:e},i(e),9,et))),128))],512),[[E,n.value.limit]])]),t("div",at,[t("button",{onClick:F,class:"btn btn-primary apply-btn"},s[13]||(s[13]=[t("span",{class:"btn-icon"},"✓",-1),_(" Применить ",-1)])),t("button",{onClick:s[4]||(s[4]=(...e)=>a(l).resetFilters&&a(l).resetFilters(...e)),class:"btn btn-secondary reset-btn"},s[14]||(s[14]=[t("span",{class:"btn-icon"},"↺",-1),_(" Сбросить ",-1)]))])])])]),a(r)?(v(),c("div",lt,s[16]||(s[16]=[t("div",{class:"spinner"},null,-1),t("p",null,"Загрузка данных...",-1)]))):a(d)?(v(),c("div",nt,[s[17]||(s[17]=t("div",{class:"error-icon"},"⚠️",-1)),s[18]||(s[18]=t("h3",null,"Произошла ошибка",-1)),t("p",null,i(a(d)),1)])):(v(),c("div",ot,[!a(r)&&!a(d)?(v(),c("div",it,[s[19]||(s[19]=t("div",{class:"card-header"},[t("h2",null,"Визуализация продаж заказов")],-1)),t("div",rt,[T(Z,{sales:a(b)},null,8,["sales"])])])):N("",!0),t("div",dt,[t("div",ut,[t("span",null,"Страница "+i(a(p))+" из "+i(a(m)),1),t("span",pt,"Всего записей: "+i(a(l).totalOrders),1)]),t("div",ct,[t("button",{onClick:s[5]||(s[5]=(...e)=>a(l).prevPage&&a(l).prevPage(...e)),disabled:a(p)===1,class:"btn-pagination"},s[20]||(s[20]=[t("span",{class:"pagination-icon"},"←",-1),_(" Назад ",-1)]),8,vt),t("button",{onClick:s[6]||(s[6]=(...e)=>a(l).nextPage&&a(l).nextPage(...e)),disabled:a(p)===a(m),class:"btn-pagination"},s[21]||(s[21]=[_(" Вперед ",-1),t("span",{class:"pagination-icon"},"→",-1)]),8,gt)])]),t("div",mt,[t("div",bt,[t("table",_t,[s[22]||(s[22]=t("thead",null,[t("tr",null,[t("th",null,"№"),t("th",null,"Скидка"),t("th",null,"Регион"),t("th",null,"Дата"),t("th",null,"Штрикод товара"),t("th",{class:"text-right"},"Полная Стоимость")])],-1)),t("tbody",null,[(v(!0),c(D,null,C(a(b),(e,o)=>(v(),c("tr",{key:e.id},[t("td",ft,i(o+1),1),t("td",null,[t("span",{class:O(["discount-badge",{"high-discount":e.discount_percent>15}])},i(e.discount_percent)+" % ",3)]),t("td",null,[t("span",yt,i(e.region_name),1)]),t("td",null,i(e.date),1),t("td",null,i(e.barcode),1),t("td",xt,[t("span",Ft,i(parseFloat(e.total_price).toFixed(2))+" руб.",1)])]))),128))])])])]),t("div",kt,[t("div",ht,[t("span",null,"Страница "+i(a(p))+" из "+i(a(m)),1)]),t("div",St,[t("button",{onClick:s[7]||(s[7]=(...e)=>a(l).prevPage&&a(l).prevPage(...e)),disabled:a(p)===1,class:"btn-pagination"},s[23]||(s[23]=[t("span",{class:"pagination-icon"},"←",-1),_(" Назад ",-1)]),8,Dt),t("button",{onClick:s[8]||(s[8]=(...e)=>a(l).nextPage&&a(l).nextPage(...e)),disabled:a(p)===a(m),class:"btn-pagination"},s[24]||(s[24]=[_(" Вперед ",-1),t("span",{class:"pagination-icon"},"→",-1)]),8,Ct)])])]))]))}},Vt=P(Pt,[["__scopeId","data-v-56ca6762"]]);export{Vt as default};
