import{d as T,r as v,_ as C,c as p,o as c,a as D,u as a,s as V,k as B,b as O,e as t,w as x,v as h,f as E,F as P,g as w,h as _,t as i,i as I}from"./index-CxXBdjJt.js";import{a as N,C as U,p as M,b as $,c as L,B as q,d as A,L as K,e as R}from"./index-B-4bjD19.js";const Y=T("stocks",()=>{const f=v([]),l=v(!1),b=v(null),o=v(1),n=v(500),r=v(1),g=e=>e.toISOString().split("T")[0],u=v({dateFrom:g(new Date),dateTo:g(new Date),limit:n.value,region:""}),S=v([25,50,100,250,500]);async function m(){try{l.value=!0,b.value=null;const y=await N.get("http://109.73.206.144:6969/api/stocks",{params:{key:"E6kUTYrYwZq2tN4QEtyzsbEBk3ie",page:o.value,limit:u.value.limit,dateFrom:u.value.dateFrom,dateTo:u.value.dateTo}});console.log("stocks: ",y.data.data),f.value=y.data.data,r.value=Math.ceil(y.data.meta.total/n.value)}catch(e){b.value=`Ошибка ${e.response?.status||400}: ${e.response?.data?.message||"Неверный запрос"}`,console.error("Детали ошибки:",e.config)}finally{l.value=!1}}function d(){o.value<r.value&&(o.value++,m())}function F(){o.value>1&&(o.value--,m())}function k(e={}){o.value=1,u.value={...u.value,...e},n.value=u.value.limit,m()}function s(){const e=new Date;k({dateFrom:g(new Date(e.setDate(e.getDate()-7))),dateTo:g(new Date),lmit:500,region:""})}return{stocks:f,loading:l,error:b,page:o,totalPages:r,filters:u,limitOptions:S,fetchStocks:m,nextPage:d,prevPage:F,applyFilters:k,resetFilters:s}}),z={class:"chart-container"},Q={__name:"StocksChart",props:{stocks:{type:Array,required:!0}},setup(f){U.register(M,$,L,q,A,K);const l=f,b={labels:l.stocks.map(n=>n.barcode),datasets:[{label:"Товары в пути от клиента",backgroundColor:"#f87979",data:l.stocks.map(n=>parseInt(n.in_way_from_client))}]},o=v({responsive:!0,maintainAspectRatio:!1,scales:{x:{title:{display:!0,text:"штрихкод товара"}},y:{title:{display:!0,text:"кол-во от клиента"}}}});return(n,r)=>(c(),p("div",z,[D(a(R),{data:b,options:o.value},null,8,["options"])]))}},Z=C(Q,[["__scopeId","data-v-c33b60aa"]]),j={class:"orders-page"},G={class:"card filters-card"},H={class:"card-body"},J={class:"filters-grid"},W={class:"filter-group"},X=["max"],tt={class:"filter-group"},st=["max"],et={class:"filter-group"},at={class:"filter-group"},lt=["value"],ot={class:"filter-actions"},nt={key:0,class:"loading-state"},it={key:1,class:"error-state"},rt={key:2},dt={key:0,class:"card chart-card"},ut={class:"card-body"},pt={class:"pagination-top"},ct={class:"pagination-info"},vt={class:"orders-count"},gt={class:"pagination-controls"},mt=["disabled"],bt=["disabled"],_t={class:"table-card card"},ft={class:"table-responsive"},yt={class:"spa-table"},kt={class:"order-number"},xt={class:"region-tag"},St={class:"text-right"},Ft={class:"price"},ht={class:"pagination-bottom"},Pt={class:"pagination-info"},wt={class:"pagination-controls"},Ct=["disabled"],Dt=["disabled"],Tt={__name:"StocksPage",setup(f){const l=Y(),{stocks:b,loading:o,error:n,page:r,totalPages:g,filters:u,limitOptions:S}=V(l),m=B(()=>new Date().toISOString().split("T")[0]),d=v({dateFrom:m.value,dateTo:m.value,region:u.value.region,limit:u.value.limit}),F=()=>{l.applyFilters(d.value)};return O(()=>{l.fetchStocks()}),(k,s)=>(c(),p("div",j,[s[27]||(s[27]=t("h2",null,"Акции",-1)),t("div",G,[s[17]||(s[17]=t("div",{class:"card-header"},[t("h2",null,"Фильтры")],-1)),t("div",H,[t("div",J,[t("div",W,[s[9]||(s[9]=t("label",null,"Дата от",-1)),x(t("input",{type:"date","onUpdate:modelValue":s[0]||(s[0]=e=>d.value.dateFrom=e),class:"filter-input",max:m.value,readonly:"",title:"Дата фиксирована - доступна только сегодняшняя выгрузка"},null,8,X),[[h,d.value.dateFrom]]),s[10]||(s[10]=t("div",{class:"filter-hint"},"*Выгрузка только за текущий день",-1))]),t("div",tt,[s[11]||(s[11]=t("label",null,"Дата до",-1)),x(t("input",{type:"date","onUpdate:modelValue":s[1]||(s[1]=e=>d.value.dateTo=e),class:"filter-input",max:m.value,readonly:"",title:"Дата фиксирована - доступна только сегодняшняя выгрузка"},null,8,st),[[h,d.value.dateTo]]),s[12]||(s[12]=t("div",{class:"filter-hint"},"*Выгрузка только за текущий день",-1))]),t("div",et,[s[13]||(s[13]=t("label",null,"Регион",-1)),x(t("input",{type:"text","onUpdate:modelValue":s[2]||(s[2]=e=>d.value.region=e),placeholder:"Введите область",class:"filter-input"},null,512),[[h,d.value.region]])]),t("div",at,[s[14]||(s[14]=t("label",null,"Записей на одну страницу",-1)),x(t("select",{"onUpdate:modelValue":s[3]||(s[3]=e=>d.value.limit=e),class:"filter-сount-per-page"},[(c(!0),p(P,null,w(a(S),e=>(c(),p("option",{key:e,value:e},i(e),9,lt))),128))],512),[[E,d.value.limit]])]),t("div",ot,[t("button",{onClick:F,class:"btn btn-primary apply-btn"},s[15]||(s[15]=[t("span",{class:"btn-icon"},"✓",-1),_(" Применить ",-1)])),t("button",{onClick:s[4]||(s[4]=(...e)=>a(l).resetFilters&&a(l).resetFilters(...e)),class:"btn btn-secondary reset-btn"},s[16]||(s[16]=[t("span",{class:"btn-icon"},"↺",-1),_(" Сбросить ",-1)]))])])])]),a(o)?(c(),p("div",nt,s[18]||(s[18]=[t("div",{class:"spinner"},null,-1),t("p",null,"Загрузка данных...",-1)]))):a(n)?(c(),p("div",it,[s[19]||(s[19]=t("div",{class:"error-icon"},"⚠️",-1)),s[20]||(s[20]=t("h3",null,"Произошла ошибка",-1)),t("p",null,i(a(n)),1)])):(c(),p("div",rt,[!a(o)&&!a(n)?(c(),p("div",dt,[s[21]||(s[21]=t("div",{class:"card-header"},[t("h2",null,"Визуализация колличества товара от клиента")],-1)),t("div",ut,[D(Z,{stocks:a(b)},null,8,["stocks"])])])):I("",!0),t("div",pt,[t("div",ct,[t("span",null,"Страница "+i(a(r))+" из "+i(a(g)),1),t("span",vt,"Всего записей: "+i(a(l).totalOrders),1)]),t("div",gt,[t("button",{onClick:s[5]||(s[5]=(...e)=>a(l).prevPage&&a(l).prevPage(...e)),disabled:a(r)===1,class:"btn-pagination"},s[22]||(s[22]=[t("span",{class:"pagination-icon"},"←",-1),_(" Назад ",-1)]),8,mt),t("button",{onClick:s[6]||(s[6]=(...e)=>a(l).nextPage&&a(l).nextPage(...e)),disabled:a(r)===a(g),class:"btn-pagination"},s[23]||(s[23]=[_(" Вперед ",-1),t("span",{class:"pagination-icon"},"→",-1)]),8,bt)])]),t("div",_t,[t("div",ft,[t("table",yt,[s[24]||(s[24]=t("thead",null,[t("tr",null,[t("th",null,"№"),t("th",null,"Название склада"),t("th",null,"Штрихкод товара"),t("th",null,"В пути от клиента"),t("th",{class:"text-right"},"Цена")])],-1)),t("tbody",null,[(c(!0),p(P,null,w(a(b),(e,y)=>(c(),p("tr",{key:e.id},[t("td",kt,i(y+1),1),t("td",null,[t("span",xt,i(e.warehouse_name),1)]),t("td",null,i(e.barcode),1),t("td",null,i(e.in_way_from_client),1),t("td",St,[t("span",Ft,i(e.price)+" руб.",1)])]))),128))])])])]),t("div",ht,[t("div",Pt,[t("span",null,"Страница "+i(a(r))+" из "+i(a(g)),1)]),t("div",wt,[t("button",{onClick:s[7]||(s[7]=(...e)=>a(l).prevPage&&a(l).prevPage(...e)),disabled:a(r)===1,class:"btn-pagination"},s[25]||(s[25]=[t("span",{class:"pagination-icon"},"←",-1),_(" Назад ",-1)]),8,Ct),t("button",{onClick:s[8]||(s[8]=(...e)=>a(l).nextPage&&a(l).nextPage(...e)),disabled:a(r)===a(g),class:"btn-pagination"},s[26]||(s[26]=[_(" Вперед ",-1),t("span",{class:"pagination-icon"},"→",-1)]),8,Dt)])])]))]))}},Ot=C(Tt,[["__scopeId","data-v-0769dda6"]]);export{Ot as default};
