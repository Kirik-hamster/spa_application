import{d as L,r as u,_ as E,c as n,o as a,a as N,u as e,s as q,b as z,e as s,w as T,v as M,f as K,F as B,g as V,h as F,t as d,i as S,j as h,n as R}from"./index-CxXBdjJt.js";import{a as Y,C as j,p as Q,b as Z,c as G,B as H,d as J,L as W,e as X}from"./index-B-4bjD19.js";const tt=L("orders",()=>{const k=u([]),l=u(!1),b=u(null),p=u(1),c=u(500),v=u(1),m=u(null),_=u("asc"),y=u(null),f=i=>i.toISOString().split("T")[0],g=u({dateFrom:f(new Date(new Date().setDate(new Date().getDate()-7))),dateTo:f(new Date),limit:c.value,region:""}),x=u([25,50,100,250,500]);async function r(){try{l.value=!0,b.value=null;const C=await Y.get("http://109.73.206.144:6969/api/orders",{params:{key:"E6kUTYrYwZq2tN4QEtyzsbEBk3ie",page:p.value,limit:g.value.limit,dateFrom:g.value.dateFrom,dateTo:g.value.dateTo}});console.log("orders: ",C.data.data),k.value=C.data.data,v.value=Math.ceil(C.data.meta.total/c.value)}catch(i){b.value=`Ошибка ${i.response?.status||400}: ${i.response?.data?.message||"Неверный запрос"}`,console.error("Детали ошибки:",i.config)}finally{l.value=!1}}function $(i,C){m.value=i,_.value=C,y.value=null,k.value.sort((A,I)=>{let O=A[i],P=I[i];return(i==="discount_percent"||i==="total_price")&&(O=parseFloat(O)||0,P=parseFloat(P)||0),C==="asc"?O>P?1:-1:O<P?1:-1})}function w(i){y.value===i?y.value=null:y.value=i}function t(){m.value=null,_.value=null,y.value=null,r()}function o(){p.value<v.value&&(p.value++,r())}function D(){p.value>1&&(p.value--,r())}function U(i={}){p.value=1,g.value={...g.value,...i},c.value=g.value.limit,r()}return{orders:k,loading:l,error:b,page:p,totalPages:v,filters:g,limitOptions:x,sortField:m,sortOrder:_,sortMenuOpen:y,fetchOrders:r,nextPage:o,prevPage:D,applyFilters:U,applySort:$,toggleSortMenu:w,clearSort:t}}),st={class:"chart-container"},et={__name:"OrdersChart",props:{orders:{type:Array,required:!0}},setup(k){j.register(Q,Z,G,H,J,W);const l=k,b={labels:l.orders.map(c=>c.barcode),datasets:[{label:"Сумма заказов товара",backgroundColor:"#f87979",data:l.orders.map(c=>parseFloat(c.total_price))}]},p=u({responsive:!0,maintainAspectRatio:!1,scales:{x:{title:{display:!0,text:"Штрихкод"}},y:{title:{display:!0,text:"Сумма (руб)"}}}});return(c,v)=>(a(),n("div",st,[N(e(X),{data:b,options:p.value},null,8,["options"])]))}},ot=E(et,[["__scopeId","data-v-d605a535"]]),lt={class:"orders-page"},nt={class:"card filters-card"},at={class:"card-body"},it={class:"filters-grid"},rt={class:"filter-group"},dt={class:"filter-group"},ut={class:"filter-group"},pt={class:"filter-group"},ct=["value"],vt={class:"filter-actions"},gt={key:0,class:"loading-state"},_t={key:1,class:"error-state"},bt={key:2},mt={key:0,class:"card chart-card"},yt={class:"card-body"},ft={class:"pagination-top"},kt={class:"pagination-info"},Ct={class:"orders-count"},Ft={class:"pagination-controls"},St=["disabled"],xt=["disabled"],Ot={class:"table-card card"},Pt={class:"table-responsive"},Tt={class:"spa-table"},$t={class:"header-content"},Dt={class:"sort-indicator"},Mt={key:0},wt={key:1},Bt={key:0,class:"sort-menu"},Vt={class:"header-content"},ht={class:"sort-indicator"},Et={key:0},Nt={key:1},Ut={key:0,class:"sort-menu"},At={class:"order-number"},It={class:"region-tag"},Lt={class:"text-right"},qt={class:"price"},zt={class:"pagination-bottom"},Kt={class:"pagination-info"},Rt={class:"pagination-controls"},Yt=["disabled"],jt=["disabled"],Qt={__name:"OrdersPage",setup(k){const l=tt(),{orders:b,loading:p,error:c,page:v,totalPages:m,filters:_,limitOptions:y,sortField:f,sortOrder:g,sortMenuOpen:x}=q(l),r=u({dateFrom:_.value.dateFrom,dateTo:_.value.dateTo,region:_.value.region,limit:_.value.limit}),$=()=>{l.applyFilters(r.value)};return z(()=>{l.fetchOrders()}),(w,t)=>(a(),n("div",lt,[t[38]||(t[38]=s("h2",null,"Заказы",-1)),s("div",nt,[t[23]||(t[23]=s("div",{class:"card-header"},[s("h2",null,"Фильтры")],-1)),s("div",at,[s("div",it,[s("div",rt,[t[17]||(t[17]=s("label",null,"Дата от",-1)),T(s("input",{type:"date","onUpdate:modelValue":t[0]||(t[0]=o=>r.value.dateFrom=o),class:"filter-input"},null,512),[[M,r.value.dateFrom]])]),s("div",dt,[t[18]||(t[18]=s("label",null,"Дата до",-1)),T(s("input",{type:"date","onUpdate:modelValue":t[1]||(t[1]=o=>r.value.dateTo=o),class:"filter-input"},null,512),[[M,r.value.dateTo]])]),s("div",ut,[t[19]||(t[19]=s("label",null,"Регион",-1)),T(s("input",{type:"text","onUpdate:modelValue":t[2]||(t[2]=o=>r.value.region=o),placeholder:"Введите область",class:"filter-input"},null,512),[[M,r.value.region]])]),s("div",pt,[t[20]||(t[20]=s("label",null,"Записей на одну страницу",-1)),T(s("select",{"onUpdate:modelValue":t[3]||(t[3]=o=>r.value.limit=o),class:"filter-сount-per-page"},[(a(!0),n(B,null,V(e(y),o=>(a(),n("option",{key:o,value:o},d(o),9,ct))),128))],512),[[K,r.value.limit]])]),s("div",vt,[s("button",{onClick:$,class:"btn btn-primary apply-btn"},t[21]||(t[21]=[s("span",{class:"btn-icon"},"✓",-1),F(" Применить ",-1)])),s("button",{onClick:t[4]||(t[4]=(...o)=>e(l).resetFilters&&e(l).resetFilters(...o)),class:"btn btn-secondary reset-btn"},t[22]||(t[22]=[s("span",{class:"btn-icon"},"↺",-1),F(" Сбросить ",-1)]))])])])]),e(p)?(a(),n("div",gt,t[24]||(t[24]=[s("div",{class:"spinner"},null,-1),s("p",null,"Загрузка данных...",-1)]))):e(c)?(a(),n("div",_t,[t[25]||(t[25]=s("div",{class:"error-icon"},"⚠️",-1)),t[26]||(t[26]=s("h3",null,"Произошла ошибка",-1)),s("p",null,d(e(c)),1)])):(a(),n("div",bt,[!e(p)&&!e(c)?(a(),n("div",mt,[t[27]||(t[27]=s("div",{class:"card-header"},[s("h2",null,"Визуализация заказов")],-1)),s("div",yt,[N(ot,{orders:e(b)},null,8,["orders"])])])):S("",!0),s("div",ft,[s("div",kt,[s("span",null,"Страница "+d(e(v))+" из "+d(e(m)),1),s("span",Ct,"Всего записей: "+d(e(l).totalOrders),1)]),s("div",Ft,[s("button",{onClick:t[5]||(t[5]=(...o)=>e(l).prevPage&&e(l).prevPage(...o)),disabled:e(v)===1,class:"btn-pagination"},t[28]||(t[28]=[s("span",{class:"pagination-icon"},"←",-1),F(" Назад ",-1)]),8,St),s("button",{onClick:t[6]||(t[6]=(...o)=>e(l).nextPage&&e(l).nextPage(...o)),disabled:e(v)===e(m),class:"btn-pagination"},t[29]||(t[29]=[F(" Вперед ",-1),s("span",{class:"pagination-icon"},"→",-1)]),8,xt)])]),s("div",Ot,[s("div",Pt,[s("table",Tt,[s("thead",null,[s("tr",null,[t[32]||(t[32]=s("th",null,"№",-1)),s("th",{class:"sortable-header",onClick:t[10]||(t[10]=h(o=>e(l).toggleSortMenu("discount_percent"),["stop"]))},[s("div",$t,[t[30]||(t[30]=s("span",null,"Скидка",-1)),s("span",Dt,[e(f)==="discount_percent"?(a(),n("span",Mt,d(e(g)==="asc"?"↑":"↓"),1)):(a(),n("span",wt,"↕"))])]),e(x)==="discount_percent"?(a(),n("div",Bt,[s("div",{class:"sort-option",onClick:t[7]||(t[7]=o=>e(l).applySort("discount_percent","asc"))}," возр. ↑ "),s("div",{class:"sort-option",onClick:t[8]||(t[8]=o=>e(l).applySort("discount_percent","desc"))}," убыв. ↓ "),e(f)==="discount_percent"?(a(),n("div",{key:0,class:"sort-option",onClick:t[9]||(t[9]=o=>e(l).clearSort())}," Сброс ")):S("",!0)])):S("",!0)]),t[33]||(t[33]=s("th",null,"Дата",-1)),t[34]||(t[34]=s("th",null,"Регион",-1)),t[35]||(t[35]=s("th",null,"Штрихкод товара",-1)),s("th",{class:"sortable-header text-right",onClick:t[14]||(t[14]=h(o=>e(l).toggleSortMenu("total_price"),["stop"]))},[s("div",Vt,[t[31]||(t[31]=s("span",null,"Сумма",-1)),s("span",ht,[e(f)==="total_price"?(a(),n("span",Et,d(e(g)==="asc"?"↑":"↓"),1)):(a(),n("span",Nt,"↕"))])]),e(x)==="total_price"?(a(),n("div",Ut,[s("div",{class:"sort-option",onClick:t[11]||(t[11]=o=>e(l).applySort("total_price","asc"))}," возр. ↑ "),s("div",{class:"sort-option",onClick:t[12]||(t[12]=o=>e(l).applySort("total_price","desc"))}," убыв. ↓ "),e(f)==="total_price"?(a(),n("div",{key:0,class:"sort-option",onClick:t[13]||(t[13]=o=>e(l).clearSort())}," сброс ")):S("",!0)])):S("",!0)])])]),s("tbody",null,[(a(!0),n(B,null,V(e(b),(o,D)=>(a(),n("tr",{key:o.id},[s("td",At,d((e(v)-1)*e(_).limit+D+1),1),s("td",null,[s("span",{class:R(["discount-badge",{"high-discount":o.discount_percent>15}])},d(o.discount_percent)+" % ",3)]),s("td",null,d(o.date),1),s("td",null,[s("span",It,d(o.oblast),1)]),s("td",null,d(o.barcode),1),s("td",Lt,[s("span",qt,d(parseFloat(o.total_price).toFixed(2))+" руб.",1)])]))),128))])])])]),s("div",zt,[s("div",Kt,[s("span",null,"Страница "+d(e(v))+" из "+d(e(m)),1)]),s("div",Rt,[s("button",{onClick:t[15]||(t[15]=(...o)=>e(l).prevPage&&e(l).prevPage(...o)),disabled:e(v)===1,class:"btn-pagination"},t[36]||(t[36]=[s("span",{class:"pagination-icon"},"←",-1),F(" Назад ",-1)]),8,Yt),s("button",{onClick:t[16]||(t[16]=(...o)=>e(l).nextPage&&e(l).nextPage(...o)),disabled:e(v)===e(m),class:"btn-pagination"},t[37]||(t[37]=[F(" Вперед ",-1),s("span",{class:"pagination-icon"},"→",-1)]),8,jt)])])]))]))}},Ht=E(Qt,[["__scopeId","data-v-c83667a3"]]);export{Ht as default};
